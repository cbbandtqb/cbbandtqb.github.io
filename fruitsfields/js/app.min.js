const chrX=56,chrY=56,roomX=18,roomY=12,dispX=chrX*roomX,dispY=chrY*(roomY+0),chr=["","wall","down","left","right","up","fruits","player"];var game={data:{fruits:0,roomNo:0,room:[],solution:""},onload:function(){me.video.init(dispX,dispY,{parent:"screen",scale:"auto",scaleMethod:"fit"})?(me.game.viewport=new me.Camera2d(0,0,dispX,dispY),me.loader.preload(game.resources,this.loaded.bind(this)),me.loader.preload([{name:"PressStart2P",type:"binary",src:"data/fnt/PressStart2P.fnt"},{name:"PressStart2P",type:"image",src:"data/fnt/PressStart2P.png"},{name:"room",type:"json",src:"data/room/room.json"}])):alert("Your browser does not support HTML5 canvas.")},loaded:function(){me.state.set(me.state.MENU,new game.TitleScreen),me.state.set(me.state.PLAY,new game.PlayScreen),me.input.bindKey(me.input.KEY.X,"click",!0),me.input.bindPointer(me.input.KEY.X),me.input.bindKey(me.input.KEY.ESC,"escape",!0),me.input.bindKey(me.input.KEY.Q,"solve",!0),game.data.room=me.loader.getJSON("room"),me.state.change(me.state.MENU)},resources:[{name:"100",type:"image",src:"data/img/100.png"},{name:"down",type:"image",src:"data/img/down.png"},{name:"exit",type:"image",src:"data/img/exit.png"},{name:"fruits",type:"image",src:"data/img/fruits.png"},{name:"left",type:"image",src:"data/img/left.png"},{name:"player",type:"image",src:"data/img/player.png"},{name:"right",type:"image",src:"data/img/right.png"},{name:"title",type:"image",src:"data/img/title.png"},{name:"title_bg",type:"image",src:"data/img/title_bg.png"},{name:"touch",type:"image",src:"data/img/touch.png"},{name:"up",type:"image",src:"data/img/up.png"},{name:"wall",type:"image",src:"data/img/wall.png"}]};game.HUD=game.HUD||{},game.HUD.Container=me.Container.extend({init:function(){me.Container.prototype.init.apply(this),this.isPersistent=!0,this.floating=!0,this.name="HUD",this.addChild(new game.HUD.ScoreItem(5,5))}}),game.HUD.ScoreItem=me.Renderable.extend({init:function(e,t){me.Renderable.prototype.init.apply(this,[e,t,10,10]),this.score=-1},update:function(){return this.score!==game.data.score&&(this.score=game.data.score,!0)},draw:function(e){}}),game.PlayerEntity=me.Entity.extend({init:function(e,t,r){me.Entity.prototype.init.apply(this,[e,t,r])},update:function(e){return this.body.update(e),me.collision.check(this),me.Entity.prototype.update.apply(this,[e])||0!==this.body.vel.x||0!==this.body.vel.y},onCollision:function(e,t){return!0}});const MANUAL=0,INPUT=1,AUTOMATIC=2,SHAKE_INTENSITY=10,SHAKE_DURATION=300,OBSTACLE=1e4,OFFSETX=63,OFFSETY=-7;var getPlayerPos=function(e){var t=new Object;for(y=0;y<12;y++)for(x=0;x<18;x++)if(7==e[y][x])return t.x=x,t.y=y,t},paint=function(e,t,r,i){var a,o,s=[];for(s.push([t,r]),e[r][t]=i;0<s.length;)a=(o=s.shift())[0],0==e[(o=o[1])+1][a]&&(s.push([a,o+1]),e[o+1][a]=i),0==e[o][a-1]&&(s.push([a-1,o]),e[o][a-1]=i),0==e[o-1][a]&&(s.push([a,o-1]),e[o-1][a]=i),0==e[o][a+1]&&(s.push([a+1,o]),e[o][a+1]=i)},isAbleToMovePlayer=function(e,t,r){for(var i=[],a=0;a<12;a++){i[a]=[];for(var o=0;o<18;o++)i[a][o]=e[a][o]}var s=getPlayerPos(e);return paint(i,s.x,s.y,7),7==i[r][t]},measure=function(e,t,r,i){return e<r?t<i?r-e+i-t:r-e+t-i:t<i?e-r+i-t:e-r+t-i},navigate=function(e,t,r,i,a){for(var o=[],s=0;s<12;s++){o[s]=[];for(var n=0;n<18;n++)0!=e[s][n]&&7!=e[s][n]?o[s][n]=OBSTACLE:o[s][n]=0}var h=[];for(h.push([i,a,1]),o[a][i]=1;0<h.length;){var m=h.shift(),l=m[0],p=m[1],c=m[2];0==o[p+1][l]&&(h.push([l,p+1,c+1]),o[p+1][l]=c+1),0==o[p][l-1]&&(h.push([l-1,p,c+1]),o[p][l-1]=c+1),0==o[p-1][l]&&(h.push([l,p-1,c+1]),o[p-1][l]=c+1),0==o[p][l+1]&&(h.push([l+1,p,c+1]),o[p][l+1]=c+1)}var d=[],l=t,c=o[p=r][l];for(o[p][l]=OBSTACLE,d.push([l,p]);1<c;){var g=l,y=p+1;(c=o[y][g])>o[p][l-1]&&(g=l-1,c=o[y=p][g]),c>o[p-1][l]&&(g=l,c=o[y=p-1][g]),c>o[p][l+1]&&(g=l+1,c=o[y=p][g]),l=g,o[p=y][l]=OBSTACLE,d.push([l,p])}return d},isCleared=!1;game.PlayScreen=me.Stage.extend({onResetEvent:function(){var u=MANUAL,v=new Object;game.data.solution=[[0,0]];var x=0,w=new Object;me.game.world.addChild(new me.ColorLayer("bg",new me.Color(197,166,136),0)),this.HUD=new game.HUD.Container,me.game.world.addChild(this.HUD);for(var S=[],e=game.data.fruits=0;e<roomY;e++){S[e]=[];for(var t=0;t<roomX;t++)S[e][t]=game.data.room[game.data.roomNo][e][t],6==S[e][t]&&game.data.fruits++}for(var T=[],r=0,e=0;e<roomY;e++){T[e]=[];for(t=0;t<roomX;t++)0!=S[e][t]&&(T[e][t]=new me.Sprite(t*chrX+chrX/2,e*chrY+chrY/2,{image:chr[S[e][t]],name:r++}),me.game.world.addChild(T[e][t]))}me.game.world.addChild(new(me.Sprite.extend({init:function(){me.Sprite.prototype.init.apply(this,[chrX/2,chrY/2,{image:"exit"}]),this.alpha=0},update:function(e){var t=me.input.globalToLocal(me.input.pointer.clientX,me.input.pointer.clientY);return t.x<chrX&&t.y<chrY?this.alpha=1:this.alpha=0,!0}}))),me.game.world.addChild(new(me.Renderable.extend({init:function(){me.Renderable.prototype.init.apply(this,[0,0,me.game.viewport.width,me.game.viewport.height]),isCleared=!1,this.itv=0},update:function(e){var t,r,i,a,o,s;(me.input.isKeyPressed("escape")||isCleared)&&me.state.change(me.state.MENU),u==MANUAL&&me.input.isKeyPressed("solve")&&(u=INPUT,v=new Solution(0,-48,"text",1e5),me.game.world.addChild(v)),u==INPUT&&-1==game.data.solution[game.data.solution.length-1][1]&&(u=AUTOMATIC,me.game.world.removeChild(v),w=new me.Sprite(game.data.solution[0][0]*chrX+OFFSETX,game.data.solution[0][1]*chrY+OFFSETY,{image:"touch"}),me.game.world.addChild(w));var n,h=-1,m=-1;if(u==MANUAL&&me.input.isKeyPressed("click")){var l=me.input.globalToLocal(me.input.pointer.clientX,me.input.pointer.clientY),h=parseInt(l.x/chrX),m=parseInt(l.y/chrY);if(0==h&&0==m)return me.state.change(me.state.MENU),!0}if(u==AUTOMATIC){if(this.itv+=e,this.itv<1e3)return!0;this.itv=0,h=game.data.solution[x][0],m=game.data.solution[x][1];e=x+1;e>=game.data.solution.length&&(e=x),w.pos.x=game.data.solution[e][0]*chrX+OFFSETX,w.pos.y=game.data.solution[e][1]*chrY+OFFSETY,x<game.data.solution.length-1&&x++}if(-1==h||-1==m)return!0;switch(S[m][h]){case 0:if(isAbleToMovePlayer(S,h,m)){o=getPlayerPos(S),s=navigate(S,o.x,o.y,h,m);for(var p=0;p<s.length;p++){var c=s[p][0],d=s[p][1];me.game.world.addChild(new MovingSprite(c,d,7,p))}S[m][h]=7,T[m][h]=T[o.y][o.x],T[m][h].pos.x=h*chrX+chrX/2,T[m][h].pos.y=m*chrY+chrY/2,S[o.y][o.x]=0,T[o.y][o.x]=null}else me.game.viewport.shake(SHAKE_INTENSITY,SHAKE_DURATION,me.game.viewport.AXIS.BOTH);break;case 1:me.game.viewport.shake(SHAKE_INTENSITY,SHAKE_DURATION,me.game.viewport.AXIS.BOTH);break;case 2:switch(S[m+1][h]){case 0:case 7:if(r=t=-1,n=1/0,o=getPlayerPos(S),0!=S[m-1][h]&&7!=S[m-1][h]||!isAbleToMovePlayer(S,h,m-1)||(t=h,r=m-1,n=measure(o.x,o.y,t,r)),(0==S[m][h-1]||7==S[m][h-1])&&isAbleToMovePlayer(S,h-1,m)&&n>measure(o.x,o.y,h-1,m)&&(t=h-1,r=m,n=measure(o.x,o.y,t,r)),(0==S[m][h+1]||7==S[m][h+1])&&isAbleToMovePlayer(S,h+1,m)&&n>measure(o.x,o.y,h+1,m)&&(t=h+1,r=m),-1==t||-1==r)return me.game.viewport.shake(SHAKE_INTENSITY,SHAKE_DURATION,me.game.viewport.AXIS.BOTH),!0;s=navigate(S,o.x,o.y,t,r);for(p=0;p<s.length;p++){c=s[p][0],d=s[p][1];me.game.world.addChild(new MovingSprite(c,d,7,p))}for(t==o.x&&r==o.y||(S[r][t]=7,T[r][t]=T[o.y][o.x],T[r][t].pos.x=t*chrX+chrX/2,T[r][t].pos.y=r*chrY+chrY/2,S[o.y][o.x]=0,T[o.y][o.x]=null),(s=[]).push([i=h,a=m]);0==S[a+1][i]||7==S[a+1][i];)a++,s.push([i,a]);for(p=0;p<s.length;p++){c=s[p][0],d=s[p][1];me.game.world.addChild(new MovingSprite(c,d,2,p))}S[a][i]=2,T[a][i]=T[m][h],T[a][i].pos.x=i*chrX+chrX/2,T[a][i].pos.y=a*chrY+chrY/2,S[m][h]=7,T[m][h]=T[r][t],T[m][h].pos.x=h*chrX+chrX/2,T[m][h].pos.y=m*chrY+chrY/2,S[r][t]=0,T[r][t]=null;break;case 1:case 2:case 3:case 4:case 6:if(0!=S[m-1][h]&&7!=S[m-1][h]||!isAbleToMovePlayer(S,h,m-1))return me.game.viewport.shake(SHAKE_INTENSITY,SHAKE_DURATION,me.game.viewport.AXIS.BOTH),!0;t=h,r=m-1,o=getPlayerPos(S),s=navigate(S,o.x,o.y,t,r);for(p=0;p<s.length;p++){c=s[p][0],d=s[p][1];me.game.world.addChild(new MovingSprite(c,d,7,p))}t==o.x&&r==o.y||(S[r][t]=7,T[r][t]=T[o.y][o.x],T[r][t].pos.x=t*chrX+chrX/2,T[r][t].pos.y=r*chrY+chrY/2,S[o.y][o.x]=0,T[o.y][o.x]=null),me.game.world.removeChild(T[m][h]),S[m][h]=7,T[m][h]=T[r][t],T[m][h].pos.x=h*chrX+chrX/2,T[m][h].pos.y=m*chrY+chrY/2,S[r][t]=0,T[r][t]=null;break;case 5:me.game.viewport.shake(SHAKE_INTENSITY,SHAKE_DURATION,me.game.viewport.AXIS.BOTH)}break;case 3:switch(S[m][h-1]){case 0:case 7:if(r=t=-1,n=1/0,o=getPlayerPos(S),0!=S[m][h+1]&&7!=S[m][h+1]||!isAbleToMovePlayer(S,h+1,m)||(t=h+1,r=m,n=measure(o.x,o.y,t,r)),(0==S[m-1][h]||7==S[m-1][h])&&isAbleToMovePlayer(S,h,m-1)&&n>measure(o.x,o.y,h,m-1)&&(t=h,r=m-1,n=measure(o.x,o.y,t,r)),(0==S[m+1][h]||7==S[m+1][h])&&isAbleToMovePlayer(S,h,m+1)&&n>measure(o.x,o.y,h,m+1)&&(t=h,r=m+1),-1==t||-1==r)return me.game.viewport.shake(SHAKE_INTENSITY,SHAKE_DURATION,me.game.viewport.AXIS.BOTH),!0;s=navigate(S,o.x,o.y,t,r);for(p=0;p<s.length;p++){c=s[p][0],d=s[p][1];me.game.world.addChild(new MovingSprite(c,d,7,p))}for(t==o.x&&r==o.y||(S[r][t]=7,T[r][t]=T[o.y][o.x],T[r][t].pos.x=t*chrX+chrX/2,T[r][t].pos.y=r*chrY+chrY/2,S[o.y][o.x]=0,T[o.y][o.x]=null),(s=[]).push([i=h,a=m]);0==S[a][i-1]||7==S[a][i-1];)--i,s.push([i,a]);for(p=0;p<s.length;p++){c=s[p][0],d=s[p][1];me.game.world.addChild(new MovingSprite(c,d,3,p))}S[a][i]=3,T[a][i]=T[m][h],T[a][i].pos.x=i*chrX+chrX/2,T[a][i].pos.y=a*chrY+chrY/2,S[m][h]=7,T[m][h]=T[r][t],T[m][h].pos.x=h*chrX+chrX/2,T[m][h].pos.y=m*chrY+chrY/2,S[r][t]=0,T[r][t]=null;break;case 1:case 2:case 3:case 5:case 6:if(0!=S[m][h+1]&&7!=S[m][h+1]||!isAbleToMovePlayer(S,h+1,m))return me.game.viewport.shake(SHAKE_INTENSITY,SHAKE_DURATION,me.game.viewport.AXIS.BOTH),!0;t=h+1,r=m,o=getPlayerPos(S),s=navigate(S,o.x,o.y,t,r);for(p=0;p<s.length;p++){c=s[p][0],d=s[p][1];me.game.world.addChild(new MovingSprite(c,d,7,p))}t==o.x&&r==o.y||(S[r][t]=7,T[r][t]=T[o.y][o.x],T[r][t].pos.x=t*chrX+chrX/2,T[r][t].pos.y=r*chrY+chrY/2,S[o.y][o.x]=0,T[o.y][o.x]=null),me.game.world.removeChild(T[m][h]),S[m][h]=7,T[m][h]=T[r][t],T[m][h].pos.x=h*chrX+chrX/2,T[m][h].pos.y=m*chrY+chrY/2,S[r][t]=0,T[r][t]=null;break;case 4:me.game.viewport.shake(SHAKE_INTENSITY,SHAKE_DURATION,me.game.viewport.AXIS.BOTH)}break;case 4:switch(S[m][h+1]){case 0:case 7:if(r=t=-1,n=1/0,o=getPlayerPos(S),0!=S[m][h-1]&&7!=S[m][h-1]||!isAbleToMovePlayer(S,h-1,m)||(t=h-1,r=m,n=measure(o.x,o.y,t,r)),(0==S[m+1][h]||7==S[m+1][h])&&isAbleToMovePlayer(S,h,m+1)&&n>measure(o.x,o.y,h,m+1)&&(t=h,r=m+1,n=measure(o.x,o.y,t,r)),(0==S[m-1][h]||7==S[m-1][h])&&isAbleToMovePlayer(S,h,m-1)&&n>measure(o.x,o.y,h,m-1)&&(t=h,r=m-1),-1==t||-1==r)return me.game.viewport.shake(SHAKE_INTENSITY,SHAKE_DURATION,me.game.viewport.AXIS.BOTH),!0;s=navigate(S,o.x,o.y,t,r);for(p=0;p<s.length;p++){c=s[p][0],d=s[p][1];me.game.world.addChild(new MovingSprite(c,d,7,p))}for(t==o.x&&r==o.y||(S[r][t]=7,T[r][t]=T[o.y][o.x],T[r][t].pos.x=t*chrX+chrX/2,T[r][t].pos.y=r*chrY+chrY/2,S[o.y][o.x]=0,T[o.y][o.x]=null),(s=[]).push([i=h,a=m]);0==S[a][i+1]||7==S[a][i+1];)i++,s.push([i,a]);for(p=0;p<s.length;p++){c=s[p][0],d=s[p][1];me.game.world.addChild(new MovingSprite(c,d,4,p))}S[a][i]=4,T[a][i]=T[m][h],T[a][i].pos.x=i*chrX+chrX/2,T[a][i].pos.y=a*chrY+chrY/2,S[m][h]=7,T[m][h]=T[r][t],T[m][h].pos.x=h*chrX+chrX/2,T[m][h].pos.y=m*chrY+chrY/2,S[r][t]=0,T[r][t]=null;break;case 1:case 2:case 4:case 5:case 6:if(0!=S[m][h-1]&&7!=S[m][h-1]||!isAbleToMovePlayer(S,h-1,m))return me.game.viewport.shake(SHAKE_INTENSITY,SHAKE_DURATION,me.game.viewport.AXIS.BOTH),!0;t=h-1,r=m,o=getPlayerPos(S),s=navigate(S,o.x,o.y,t,r);for(p=0;p<s.length;p++){c=s[p][0],d=s[p][1];me.game.world.addChild(new MovingSprite(c,d,7,p))}t==o.x&&r==o.y||(S[r][t]=7,T[r][t]=T[o.y][o.x],T[r][t].pos.x=t*chrX+chrX/2,T[r][t].pos.y=r*chrY+chrY/2,S[o.y][o.x]=0,T[o.y][o.x]=null),me.game.world.removeChild(T[m][h]),S[m][h]=7,T[m][h]=T[r][t],T[m][h].pos.x=h*chrX+chrX/2,T[m][h].pos.y=m*chrY+chrY/2,S[r][t]=0,T[r][t]=null;break;case 3:me.game.viewport.shake(SHAKE_INTENSITY,SHAKE_DURATION,me.game.viewport.AXIS.BOTH)}break;case 5:switch(S[m-1][h]){case 0:case 7:if(r=t=-1,n=1/0,o=getPlayerPos(S),0!=S[m+1][h]&&7!=S[m+1][h]||!isAbleToMovePlayer(S,h,m+1)||(t=h,r=m+1,n=measure(o.x,o.y,t,r)),(0==S[m][h+1]||7==S[m][h+1])&&isAbleToMovePlayer(S,h+1,m)&&n>measure(o.x,o.y,h+1,m)&&(t=h+1,r=m,n=measure(o.x,o.y,t,r)),(0==S[m][h-1]||7==S[m][h-1])&&isAbleToMovePlayer(S,h-1,m)&&n>measure(o.x,o.y,h-1,m)&&(t=h-1,r=m),-1==t||-1==r)return me.game.viewport.shake(SHAKE_INTENSITY,SHAKE_DURATION,me.game.viewport.AXIS.BOTH),!0;s=navigate(S,o.x,o.y,t,r);for(p=0;p<s.length;p++){c=s[p][0],d=s[p][1];me.game.world.addChild(new MovingSprite(c,d,7,p))}for(t==o.x&&r==o.y||(S[r][t]=7,T[r][t]=T[o.y][o.x],T[r][t].pos.x=t*chrX+chrX/2,T[r][t].pos.y=r*chrY+chrY/2,S[o.y][o.x]=0,T[o.y][o.x]=null),(s=[]).push([i=h,a=m]);0==S[a-1][i]||7==S[a-1][i];)--a,s.push([i,a]);for(p=0;p<s.length;p++){c=s[p][0],d=s[p][1];me.game.world.addChild(new MovingSprite(c,d,5,p))}S[a][i]=5,T[a][i]=T[m][h],T[a][i].pos.x=i*chrX+chrX/2,T[a][i].pos.y=a*chrY+chrY/2,S[m][h]=7,T[m][h]=T[r][t],T[m][h].pos.x=h*chrX+chrX/2,T[m][h].pos.y=m*chrY+chrY/2,S[r][t]=0,T[r][t]=null;break;case 1:case 3:case 4:case 5:case 6:if(0!=S[m+1][h]&&7!=S[m+1][h]||!isAbleToMovePlayer(S,h,m+1))return me.game.viewport.shake(SHAKE_INTENSITY,SHAKE_DURATION,me.game.viewport.AXIS.BOTH),!0;t=h,r=m+1,o=getPlayerPos(S),s=navigate(S,o.x,o.y,t,r);for(p=0;p<s.length;p++){c=s[p][0],d=s[p][1];me.game.world.addChild(new MovingSprite(c,d,7,p))}t==o.x&&r==o.y||(S[r][t]=7,T[r][t]=T[o.y][o.x],T[r][t].pos.x=t*chrX+chrX/2,T[r][t].pos.y=r*chrY+chrY/2,S[o.y][o.x]=0,T[o.y][o.x]=null),me.game.world.removeChild(T[m][h]),S[m][h]=7,T[m][h]=T[r][t],T[m][h].pos.x=h*chrX+chrX/2,T[m][h].pos.y=m*chrY+chrY/2,S[r][t]=0,T[r][t]=null;break;case 2:me.game.viewport.shake(SHAKE_INTENSITY,SHAKE_DURATION,me.game.viewport.AXIS.BOTH)}break;case 6:if(r=t=-1,n=1/0,o=getPlayerPos(S),0!=S[m+1][h]&&7!=S[m+1][h]||!isAbleToMovePlayer(S,h,m+1)||(t=h,r=m+1,n=measure(o.x,o.y,t,r)),(0==S[m][h-1]||7==S[m][h-1])&&isAbleToMovePlayer(S,h-1,m)&&n>measure(o.x,o.y,h-1,m)&&(t=h-1,r=m,n=measure(o.x,o.y,t,r)),(0==S[m-1][h]||7==S[m-1][h])&&isAbleToMovePlayer(S,h,m-1)&&n>measure(o.x,o.y,h,m-1)&&(t=h,r=m-1,n=measure(o.x,o.y,t,r)),(0==S[m][h+1]||7==S[m][h+1])&&isAbleToMovePlayer(S,h+1,m)&&n>measure(o.x,o.y,h+1,m)&&(t=h+1,r=m),-1==t||-1==r)return me.game.viewport.shake(SHAKE_INTENSITY,SHAKE_DURATION,me.game.viewport.AXIS.BOTH),!0;s=navigate(S,o.x,o.y,t,r);for(p=0;p<s.length;p++){c=s[p][0],d=s[p][1];me.game.world.addChild(new MovingSprite(c,d,7,p))}if(t==o.x&&r==o.y||(S[r][t]=7,T[r][t]=T[o.y][o.x],T[r][t].pos.x=t*chrX+chrX/2,T[r][t].pos.y=r*chrY+chrY/2,S[o.y][o.x]=0,T[o.y][o.x]=null),me.game.world.removeChild(T[m][h]),me.game.world.addChild(new ThrowingSprite(h,m,6)),S[m][h]=7,T[m][h]=T[r][t],T[m][h].pos.x=h*chrX+chrX/2,T[m][h].pos.y=m*chrY+chrY/2,S[r][t]=0,T[r][t]=null,--game.data.fruits,0==game.data.fruits)for(var g=0;g<12;g++)for(var y=0;y<18;y++)0!=S[g][y]&&7!=S[g][y]&&me.game.world.addChild(new ImplodingSprite(y,g,S[g][y],T[g][y]))}return!0},draw:function(e){},onDestroyEvent:function(){}})),3)},onDestroyEvent:function(){me.game.world.removeChild(this.HUD)}}),ImplodingSprite=me.Sprite.extend({init:function(e,t,r,i){me.game.world.removeChild(i),me.Sprite.prototype.init.apply(this,[e*chrX+chrX/2,t*chrY+chrY/2,{image:chr[r]}]),this.tm=30,this.itv=0,this.gix=e*chrX+chrX/2,this.giy=t*chrY+chrY/2,this.gcx=dispX/2,this.gcy=dispY/2,this.gmx=(this.gix+this.gcx)/2,this.gmy=(this.giy+this.gcy)/2,this.r=Math.sqrt((this.gcx-this.gix)*(this.gcx-this.gix)+(this.gcy-this.giy)*(this.gcy-this.giy)),this.th=Math.atan2(this.gcy-this.giy,this.gcx-this.gix)},update:function(e){return this.itv+=e,this.itv<100||((this.itv=0)<this.tm?(--this.tm,this.alpha=this.tm*this.tm/900,this.r=.85*this.r,this.th-=2*Math.PI*3/30,this.pos.x=this.gcx+this.r*Math.cos(this.th),this.pos.y=this.gcy+this.r*Math.sin(this.th),!0):isCleared=!0)}}),MovingSprite=me.Sprite.extend({init:function(e,t,r,i){me.Sprite.prototype.init.apply(this,[e*chrX+chrX/2,t*chrY+chrY/2,{image:chr[r]}]),this.tm=1+i/10,this.itv=0},update:function(e){return this.itv+=e,this.itv<100||(this.itv=0,this.tm-=.25,this.tm<1&&(this.tm<0&&(this.tm=0),this.alpha=this.tm),this.tm<=0&&me.game.world.removeChild(this)),!0}}),ThrowingSprite=me.Sprite.extend({init:function(e,t,r){me.Sprite.prototype.init.apply(this,[e*chrX+chrX/2,t*chrY+chrY/2,{image:chr[r]}]),this.tm=4,this.itv=0,this.by=this.pos.y},update:function(e){return this.itv+=e,this.itv<100||(this.itv=0,this.tm-=.2,this.pos.y=this.by+(this.tm-2)*(this.tm-2)*chrY*3/4-3*chrY,this.tm<1&&(this.tm<0&&(this.tm=0),this.alpha=this.tm),this.tm<=0&&me.game.world.removeChild(this)),!0}}),Solution=me.Renderable.extend({init:function(e,t,r,i){me.Renderable.prototype.init.apply(this,[e,t,100,100]),this.$input=$('<input type="'+r+'" maxlentgh="'+i+'" required>').css({left:e,top:t,width:i,"font-size":"x-large"}),$(me.video.getParent()).append(this.$input)},update:function(e){var t=this.$input.val(),r=[];try{r=JSON.parse(t||"null")}catch(e){r=null}return game.data.solution=null!=r?r:[[0,0]],!0},destroy:function(){this.$input.remove()}});const sx=72,sy=30;game.TitleScreen=me.Stage.extend({onResetEvent:function(){me.game.world.addChild(new me.ColorLayer("bg",new me.Color(197,166,136),0)),me.game.world.addChild(new me.Sprite(dispX/2,dispY/4,{image:"title_bg"})),me.game.world.addChild(new me.Sprite(dispX/2,dispY/4,{image:"title"})),me.game.world.addChild(new me.Sprite(dispX/2,3*dispY/4,{image:"100"})),me.game.world.addChild(new(me.Renderable.extend({init:function(){me.Renderable.prototype.init.apply(this,[0,0,me.game.viewport.width,me.game.viewport.height]),this.font=new me.BitmapText(1,1,{font:"PressStart2P",size:1})},update:function(e){var t;return me.input.isKeyPressed("click")&&(t=me.input.globalToLocal(me.input.pointer.clientX,me.input.pointer.clientY),rx=Math.floor((t.x-(dispX/2-5*sx))/sx),ry=Math.floor((t.y-(3*dispY/4-5*sy))/sy),0<=rx&&rx<10&&0<=ry&&ry<10&&(game.data.roomNo=10*ry+rx,me.state.change(me.state.PLAY))),!0},onDestroyEvent:function(){}})),3)},onDestroyEvent:function(){}});